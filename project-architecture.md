# مخطط هيكلي لمشروع المتجر الإلكتروني

## 1. نظرة عامة على الهيكل

```
+------------------+        +------------------+
|                  |        |                  |
|  واجهة المستخدم  | <----> |  واجهة الخلفية   |
|    (Angular)     |  HTTP  |  (ASP.NET Core)  |
|                  |  API   |                  |
+------------------+        +--------+---------+
                                     |
                                     | Entity Framework Core
                                     |
                            +--------v---------+
                            |                  |
                            |  قاعدة البيانات   |
                            |   (SQL Server)   |
                            |                  |
                            +------------------+
```

## 2. هيكل واجهة المستخدم (Angular)

```
+----------------------------------+
|           Angular App            |
+----------------------------------+
|                                  |
|  +-------------+  +------------+ |
|  |             |  |            | |
|  |  متجر العملاء |  | لوحة المسؤول| |
|  |             |  |            | |
|  +------+------+  +-----+------+ |
|         ^               ^        |
|         |               |        |
|  +------v------+  +-----v------+ |
|  |             |  |            | |
|  |   الخدمات    |  |   الخدمات   | |
|  |  المشتركة    |  |   المشتركة  | |
|  |             |  |            | |
|  +------+------+  +-----+------+ |
|         |               |        |
|         v               v        |
|  +----------------------------------+
|  |        HTTP Interceptors         |
|  +----------------------------------+
|                  |                  |
+------------------+------------------+
                   |
                   v
          +------------------+
          |                  |
          |    REST API      |
          |                  |
          +------------------+
```

## 3. هيكل واجهة الخلفية (ASP.NET Core)

```
+----------------------------------+
|         ASP.NET Core API         |
+----------------------------------+
|                                  |
|  +-------------+  +------------+ |
|  |             |  |            | |
|  | Controllers |  |  Services  | |
|  |             |  |            | |
|  +------+------+  +-----+------+ |
|         ^               ^        |
|         |               |        |
|         v               |        |
|  +------+------+  +-----v------+ |
|  |             |  |            | |
|  |    DTOs     |  |   Models   | |
|  |             |  |            | |
|  +------+------+  +-----+------+ |
|         ^               ^        |
|         |               |        |
|         +-------+-------+        |
|                 |                |
|        +--------v--------+       |
|        |                 |       |
|        | DbContext (EF)  |       |
|        |                 |       |
|        +-----------------+       |
|                 |                |
+------------------+---------------+
                   |
                   v
          +------------------+
          |                  |
          |   SQL Server     |
          |                  |
          +------------------+
```

## 4. نموذج البيانات

```
+---------------+       +---------------+
|     User      |       |   Category    |
+---------------+       +---------------+
| Id            |       | Id            |
| Name          |       | Name          |
| Email         |       | Description   |
| PasswordHash  |       | ImageUrl      |
| Phone         |       | Active        |
| Role          |       | CreatedAt     |
| Avatar        |       | UpdatedAt     |
| CreatedAt     |       +-------+-------+
| UpdatedAt     |               |
| IsActive      |               |
+-------+-------+               |
        |                       |
        |                       |
        v                       v
+---------------+       +---------------+
|     Order     |       |    Product    |
+---------------+       +---------------+
| Id            |       | Id            |
| OrderNumber   |       | Name          |
| UserId        |<---+  | Description   |
| Status        |    |  | Price         |
| TotalAmount   |    |  | Discount      |
| PaymentMethod |    |  | Stock         |
| PaymentStatus |    |  | CategoryId    |<--+
| OrderDate     |    |  | ImageUrl      |   |
| TrackingNumber|    |  | Rating        |   |
| ShippingCompany|   |  | Featured      |   |
| Notes         |    |  | Active        |   |
| CreatedAt     |    |  | CreatedAt     |   |
| UpdatedAt     |    |  | UpdatedAt     |   |
+-------+-------+    |  +---------------+   |
        |            |                      |
        |            +----------------------+
        |
        v
+---------------+
|   OrderItem   |
+---------------+
| Id            |
| OrderId       |<--+
| ProductId     |<----+
| Quantity      |   | |
| Price         |   | |
| Discount      |   | |
| Total         |   | |
+---------------+   | |
                    | |
                    | |
+-------------------+ |
|                     |
+---------------------+
```

## 5. تدفق المصادقة

```
+------------------+                  +------------------+                  +------------------+
|                  |                  |                  |                  |                  |
|     المستخدم      |  بيانات الاعتماد   |   UsersController |                  |   TokenService   |
|                  | ---------------> |                  | ---------------> |                  |
|                  |                  |                  |                  |                  |
+------------------+                  +------------------+                  +------------------+
        ^                                     |                                     |
        |                                     |                                     |
        |                                     |                                     |
        |              JWT Token              |                                     |
        | <---------------------------------- | <---------------------------------- |
        |                                     |                                     |
+------------------+                  +------------------+                  +------------------+
|                  |                  |                  |                  |                  |
|  AuthInterceptor |     JWT Token    |  API Controllers |                  |  JWT Middleware  |
|                  | ---------------> |                  | ---------------> |                  |
|                  |                  |                  |                  |                  |
+------------------+                  +------------------+                  +------------------+
```

## 6. تدفق الطلب

```
+------------------+                  +------------------+                  +------------------+
|                  |                  |                  |                  |                  |
|     العميل        |  إضافة إلى السلة   |    CartService   |                  |  LocalStorage    |
|                  | ---------------> |                  | ---------------> |                  |
|                  |                  |                  |                  |                  |
+------------------+                  +------------------+                  +------------------+
        |                                     ^
        |                                     |
        v                                     |
+------------------+                  +------------------+
|                  |                  |                  |
|  CheckoutComponent|  إتمام الشراء     |  OrderService    |
|                  | ---------------> |                  |
|                  |                  |                  |
+------------------+                  +------------------+
                                              |
                                              |
                                              v
                                     +------------------+                  +------------------+
                                     |                  |                  |                  |
                                     |  OrdersController|                  |  Orders Table    |
                                     |                  | ---------------> |                  |
                                     |                  |                  |                  |
                                     +------------------+                  +------------------+
```

## 7. لوحة تحكم المسؤول

```
+------------------+
|                  |
| AdminLayoutComponent|
|                  |
+--------+---------+
         |
         |
+--------v---------+
|                  |
|    Sidebar       |
|                  |
+------------------+
         |
         |
         v
+------------------+------------------+------------------+------------------+
|                  |                  |                  |                  |
| DashboardComponent| ProductsComponent| OrdersComponent  | UsersComponent   |
|                  |                  |                  |                  |
+------------------+------------------+------------------+------------------+
         |                  |                  |                  |
         |                  |                  |                  |
         v                  v                  v                  v
+------------------+------------------+------------------+------------------+
|                  |                  |                  |                  |
| ReportService    | ProductService   | OrderService     | UserService      |
|                  |                  |                  |                  |
+------------------+------------------+------------------+------------------+
         |                  |                  |                  |
         |                  |                  |                  |
         v                  v                  v                  v
+------------------+------------------+------------------+------------------+
|                  |                  |                  |                  |
| ApiService       | ApiService       | ApiService       | ApiService       |
|                  |                  |                  |                  |
+------------------+------------------+------------------+------------------+
         |                  |                  |                  |
         |                  |                  |                  |
         v                  v                  v                  v
+------------------+------------------+------------------+------------------+
|                  |                  |                  |                  |
| API Controllers  | API Controllers  | API Controllers  | API Controllers  |
|                  |                  |                  |                  |
+------------------+------------------+------------------+------------------+
```

## 8. تدفق البيانات في واجهة المستخدم

```
+------------------+
|                  |
|    Component     |
|                  |
+--------+---------+
         |
         | 1. طلب البيانات
         v
+------------------+
|                  |
|     Service      |
|                  |
+--------+---------+
         |
         | 2. طلب HTTP
         v
+------------------+
|                  |
|   ApiService     |
|                  |
+--------+---------+
         |
         | 3. إضافة التوكن
         v
+------------------+
|                  |
| AuthInterceptor  |
|                  |
+--------+---------+
         |
         | 4. إرسال الطلب
         v
+------------------+
|                  |
|    REST API      |
|                  |
+--------+---------+
         |
         | 5. استجابة
         v
+------------------+
|                  |
|     Service      |
|                  |
+--------+---------+
         |
         | 6. معالجة البيانات
         v
+------------------+
|                  |
|    Component     |
|                  |
+------------------+
```

## 9. تدفق البيانات في واجهة الخلفية

```
+------------------+
|                  |
|  HTTP Request    |
|                  |
+--------+---------+
         |
         | 1. استقبال الطلب
         v
+------------------+
|                  |
| JWT Middleware   |
|                  |
+--------+---------+
         |
         | 2. التحقق من التوكن
         v
+------------------+
|                  |
|   Controller     |
|                  |
+--------+---------+
         |
         | 3. معالجة الطلب
         v
+------------------+
|                  |
|     Service      |
|                  |
+--------+---------+
         |
         | 4. الوصول للبيانات
         v
+------------------+
|                  |
|   DbContext      |
|                  |
+--------+---------+
         |
         | 5. استعلام قاعدة البيانات
         v
+------------------+
|                  |
|  SQL Server      |
|                  |
+--------+---------+
         |
         | 6. نتائج الاستعلام
         v
+------------------+
|                  |
|   DbContext      |
|                  |
+--------+---------+
         |
         | 7. تحويل البيانات
         v
+------------------+
|                  |
|     Service      |
|                  |
+--------+---------+
         |
         | 8. تحويل إلى DTO
         v
+------------------+
|                  |
|   Controller     |
|                  |
+--------+---------+
         |
         | 9. إرسال الاستجابة
         v
+------------------+
|                  |
|  HTTP Response   |
|                  |
+------------------+
```
